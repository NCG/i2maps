OpenLayers.Geometry.Collection.prototype.getCoords=function(){var d=[];for(var b=0;b<this.components.length;++b){var f=this.components[b].getCoords();var e=f.length;for(var a=0;a<e;a++){d.push(f.shift())}}return d};OpenLayers.Geometry.Collection.prototype.setCoords=function(b){for(var a=0;a<this.components.length;++a){this.components[a].setCoords(b)}return b};OpenLayers.Geometry.LinearRing.prototype.getCoords=function(){var d=[];for(var b=0;b<this.components.length;++b){var f=this.components[b].getCoords();var e=f.length;for(var a=0;a<e;a++){d.push(f.shift())}}return d};OpenLayers.Geometry.LinearRing.prototype.setCoords=function(b){for(var a=0;a<this.components.length;++a){this.components[a].setCoords(b)}return b};OpenLayers.Geometry.Point.prototype.getCoords=function(){return[this.x,this.y]};OpenLayers.Geometry.Point.prototype.setCoords=function(a){if(a.length<2){return}this.x=a.shift();this.y=a.shift();this.clearBounds()};OpenLayers.Layer.Vector.prototype.drawFeatures=function(b){for(var a=0;a<this.features.length;a++){this.drawFeature(this.features[a],b)}};OpenLayers.Map.prototype.showMessage=function(c,b){$.showMessage(c,b);return;if(b==undefined){b="info"}if(this.messageBoxActive==undefined){this.messageBoxActive=true}if(this.messageBoxActive==false){return}if(this.messageCounter==undefined){this.messageCounter=1}else{this.messageCounter+=1}if(this.messageDiv==undefined||this.messageDiv==null){this.createMessageDiv()}var a="";if(b=="progress"){a+='<img src="../media/images/busy_icon.gif" style="vertical-align: middle;" />&nbsp;&nbsp;&nbsp;'}this.messageDiv.set("html","<p>"+a+c+"</p>");this.centerMessage();this.messageDiv.setStyle("opacity","1");this.messageDivBackground.setStyle("opacity","0.5")};OpenLayers.Map.prototype.hideMessage=function(){$.hideMessage();return;if(this.messageCounter==0){return}this.messageCounter-=1;if(this.messageCounter>0){return}if(this.messageDiv!=undefined&&this.messageDiv!=null){this.messageDiv.setStyle("opacity","1")}if(this.messageDivBackground!=undefined&&this.messageDivBackground!=null){this.messageDivBackground.setStyle("opacity","0.5")}};OpenLayers.Map.prototype.createMessageDiv=function(){this.messageDivBackground=new Element("div",{id:this.id+"_message_bg_div",styles:{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%","background-color":"#666",opacity:"0",display:"block","z-index":"999"}});this.messageDivBackground.inject(this.div);this.messageDiv=new Element("div",{id:this.id+"_message_div",styles:{position:"absolute",top:"50px",left:"50px",width:"400px",height:"100px","background-color":"#fff","z-index":"1500","text-align":"center",display:"table-cell","vertical-align":"middle","font-size":"24px",margin:"10px",opacity:"0"}});this.messageDiv.inject(this.div)};OpenLayers.Map.prototype.centerMessage=function(){var b=(this.getSize().w-this.messageDiv.getSize().x)/2;if(b<0){b=0}var a=(this.getSize().h-this.messageDiv.getSize().y-150)/2;if(a<0){a=0}this.messageDiv.style.left=b+"px";this.messageDiv.style.top=a+"px"};OpenLayers.Time={};OpenLayers.Time.dateTimeStringToNumber=function(a){var b=a.toString().replace(/[^0-9\.]/g,"");return parseFloat(b)};OpenLayers.Layer.ComplexVector=OpenLayers.Class(OpenLayers.Layer.Vector,{isBaseLayer:false,ratio:1.2,maxNumberOfGeometryPerRequest:50,initialize:function(d,c,f,b){if(b==undefined){b={}}OpenLayers.Util.extend(b,{reportError:false});var a=[];a.push(d,b);OpenLayers.Layer.Vector.prototype.initialize.apply(this,a);this.url=c;this.datasetId=f;this.jsonParser=new OpenLayers.Format.JSON();this.featureList=[];this.geometries=new TAFFY([]);this.attributes=new TAFFY([]);this.attributeNames=[];this.spaces=[];this.timeSpan=null;this.geometryLists=[];this.dateTimePattern="yyyy-mm-dd";if(b.theme!=undefined&&b.theme.type!="attribute"){this.initTheme(b.theme)}var e=this.url.replace("${operation}","GetInfo");OpenLayers.Request.GET({url:e,params:{dataset:this.datasetId},success:this.getInfoSuccess,failure:this.getInfoFailure,scope:this})},destroy:function(){this.ratio=null;this.url=null;this.datasetId=null;this.geometries=null;this.attributes=null;OpenLayers.Layer.Vector.prototype.destroy.apply(this,arguments)},moveTo:function(b,a,c){OpenLayers.Layer.Vector.prototype.moveTo.apply(this,arguments);if(!c){this.getGeometries()}},setMap:function(a){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);a.events.register("zoomend",this,this.onZoom);if(this.map!=undefined&&this.map!=null&&this.map.hideMessage!=undefined){this.map.showMessage("Loading...","Progress")}},setTime:function(d){this.map.showMessage("Loading...","Progress");this.currentTime=this.dateTimeToString(d);if(this.theme==undefined){return}var c=this.attributes.find({time:this.currentTime});if(c.length==0){var a=this.url.replace("${operation}","GetAttributes");var b=this.theme.attributes().join(",");OpenLayers.Request.GET({url:a,params:{dataset:this.datasetId,attributes:b,time:this.currentTime},success:this.getAttributesSuccess,failure:this.getAttributesFailure,scope:this})}else{this.reloadFeatures();this.map.hideMessage()}},setSpace:function(a){this.map.showMessage("Loading...","Progress");this.currentSpace=a;this.getGeometryList();this.map.hideMessage()},onZoom:function(){if(this.map==undefined||this.currentTime==undefined||this.currentSpace==undefined||this.currentGeneralization==undefined){return}var a=this.getBestGenerlizationLevel({generalization:this.currentGeneralization});this.currentGeneralization=this.map.getZoom();var b=this.getBestGenerlizationLevel();if(a!=b){this.getGeometryList()}},reloadFeatures:function(){var l=this.getWideExtent();var b=this.getNearestTimeStepForGeometries();var a=this.getBestGenerlizationLevel({time:b,space:this.currentSpace});var o=this.geometries.get({time:b,space:this.currentSpace,generalization:a,xmin:{lt:l.right},xmax:{gt:l.left},ymin:{lt:l.top},ymax:{gt:l.bottom},geom:{"!is":null}});var p=[];for(var d in this.features){p.push(this.features[d])}var k=[];for(var h in this.selectedFeatures){k.push(this.selectedFeatures[h].attributes.fid)}var c={};var e=[];var m={};for(var d in this.features){m[this.features[d].id]=this.features[d]}for(var g=0;g<o.length;g++){var j=o[g].geom;c[j.id]=j;if(j.id in m==false){e.push(j)}}this.addFeatures(e);var n=[];for(var d in p){if(p[d].id in c==false){n.push(p[d])}}this.removeFeatures(n);this.updateTheme();this.renderer.clear();this.drawFeatures()},initTheme:function(a){if(a==undefined){return}if(a.source==undefined){a.source="theme"}if(a.type==undefined){a.type="standard"}if(a.source=="theme"){if(a.type=="choropleth"){this.theme=new OpenLayers.Theme.ChoroplethTheme(a)}else{this.theme=new OpenLayers.Theme.StandardTheme(a)}}},updateTheme:function(c){if(this.theme==undefined||this.theme==null){return}for(var a in this.features){var d=this.features[a];if((d.attributes.t!=this.currentTime||d.attributes.needsUpdate==true)&&(this.theme!=undefined&&this.theme!=null)){var b=this.attributes.get({fid:d.attributes.fid,time:this.currentTime});if(b.length>0){this.theme.updateFeature(d,b[0])}d.attributes.t=this.currentTime;d.attributes.needsUpdate=false}}},getInfoSuccess:function(c){var d=this.jsonParser.read(c.responseText);this.featureList=d.features;this.attributeNames=d.attributes;this.timeSpan=d.timeSpan;this.spaces={};for(var b=0;b<d.spaces.length;b++){this.spaces[d.spaces[b].id]=d.spaces[b]}if(this.currentTime==undefined){this.currentTime=this.timeSpan.max}if(this.currentSpace==undefined){this.currentSpace="orig"}this.currentGeneralization=0;if(this.map!=undefined){this.currentGeneralization=this.map.getZoom()}this.getGeometryList();if(this.theme!=undefined){getUrl=this.url.replace("${operation}","GetAttributes");var a=this.theme.attributes().join(",");getUrl=this.url.replace("${operation}","GetAttributes");OpenLayers.Request.GET({url:getUrl,params:{dataset:this.datasetId,attributes:a,time:this.currentTime},success:this.getAttributesSuccess,failure:this.getAttributesFailure,scope:this})}},getInfoFailure:function(a){},getNearestTimeStepForGeometries:function(c){if(c==undefined){c={}}if(c.time==undefined){c.time=this.currentTime}var e=OpenLayers.Time.dateTimeStringToNumber(c.time);if(c.space==undefined){c.space=this.currentSpace}var a=this.spaces[c.space].availableGeometries;var f={};for(var d=0;d<a.length;d++){t=OpenLayers.Time.dateTimeStringToNumber(a[d].timeStep);f[a[d].timeStep]=t}diff=null;diffKey=null;for(var b in f){if(diff==null||Math.abs(f[b]-e)<diff){diff=Math.abs(f[b]-e);diffKey=b}}return b},getBestGenerlizationLevel:function(a){if(a==undefined){a={}}if(a.time==undefined){a.time=this.getNearestTimeStepForGeometries()}if(a.space==undefined){a.space=this.currentSpace}if(a.generalization==undefined){a.generalization=this.currentGeneralization}var c=this.spaces[a.space].availableGeometries;var d=[];for(var b=0;b<c.length;b++){if(c[b].timeStep==a.time){d=c[b].generalizations.split(",");b=c.length}}if(d.length==0){return null}d.sort();for(var b=(d.length-1);b>=0;b--){if(d[b]<=a.generalization){return d[b]}}return null},getGeometryList:function(e){var a=this.url.replace("${operation}","GetGeometryList");var c=this.getNearestTimeStepForGeometries();var d=this.getBestGenerlizationLevel({time:c,space:this.currentSpace});var b={time:c,space:this.currentSpace,generalization:d};for(var f in this.geometryLists){var g=this.geometryLists[f];if(b.time==g.time&&b.space==g.space&&b.generalization==g.generalization){this.reloadFeatures();return}}this.geometryLists.push(b);OpenLayers.Request.GET({url:a,params:{dataset:this.datasetId,time:c,space:this.currentSpace,generalization:d},success:this.getGeometryListSuccess,failure:this.getGeometryListFailure,scope:this})},getGeometryListSuccess:function(d){var c=this.jsonParser.read(d.responseText);for(var a=0;a<c.geometries.length;a++){var b=c.geometries[a];if(this.geometries.find({geomid:b.id}).length>0){this.geometries.update({time:c.time,space:c.space,generalization:c.generalization,feature:b.feature,xmin:b.envelope.xmin,xmax:b.envelope.xmax,ymin:b.envelope.ymin,ymax:b.envelope.ymax},{geomid:b.id})}else{this.geometries.insert({geomid:b.id,time:c.time,space:c.space,generalization:c.generalization,feature:b.feature,geom:null,xmin:b.envelope.xmin,xmax:b.envelope.xmax,ymin:b.envelope.ymin,ymax:b.envelope.ymax})}}this.getGeometries()},getGeometryListFailure:function(a){if(this.map!=undefined&&this.map!=null&&this.map.hideMessage!=undefined){this.map.hideMessage()}},getGeometries:function(){if(this.map==undefined||this.currentTime==undefined||this.currentSpace==undefined||this.currentGeneralization==undefined){return}var a=this.getWideExtent();var c=this.getNearestTimeStepForGeometries();var d=this.getBestGenerlizationLevel({time:c,space:this.currentSpace});var e=this.geometries.get({time:c,space:this.currentSpace,generalization:d,xmin:{lt:a.right},xmax:{gt:a.left},ymin:{lt:a.top},ymax:{gt:a.bottom},geom:null});var f=[];for(var b=0;b<e.length;b++){f.push(e[b].feature)}if(f.length==0){this.reloadFeatures();return}getUrl=this.url.replace("${operation}","GetGeometries");OpenLayers.Request.GET({url:getUrl,params:{dataset:this.datasetId,time:c,space:this.currentSpace,generalization:d,features:f.join(",")},success:this.getGeometriesSuccess,failure:this.getGeometriesFailure,scope:this})},getGeometriesSuccess:function(d){var c=this.jsonParser.read(d.responseText);var a=new OpenLayers.Format.GeoJSON();for(var f in c.geometries){var e=a.read(c.geometries[f],"Geometry");var b=new OpenLayers.Feature.Vector(e,{fid:f,fillColor:"#aaa",t:null,needsUpdate:true});this.geometries.update({geom:b},{time:c.time,space:c.space,generalization:c.generalization,feature:f})}this.reloadFeatures();if(this.map!=undefined&&this.map!=null&&this.map.hideMessage!=undefined){this.map.hideMessage()}},getGeometriesFailure:function(a){if(this.map!=undefined&&this.map!=null&&this.map.hideMessage!=undefined){this.map.hideMessage()}},getAttributesSuccess:function(b){var a=this.jsonParser.read(b.responseText);for(var c in a.attributes){if(this.attributes.find({fid:c,time:a.time}).length==0){this.attributes.insert({fid:c,time:a.time})}this.attributes.update(a.attributes[c],{fid:c,time:a.time})}this.reloadFeatures();this.map.hideMessage()},getAttributesFailure:function(a){},getWideExtent:function(){var a=this.map.getExtent();var b=a.getWidth();var d=a.getHeight();var c=(b*(this.ratio-1))/2;var e=(d*(this.ratio-1))/2;a.left-=c;a.right+=c;a.top+=e;a.bottom-=e;return a},dateTimeToString:function(a){if(this.dateTimePattern==undefined||this.dateTimePattern==null||this.dateTimePattern==""){return a.toString()}return a.format(this.dateTimePattern)},CLASS_NAME:"OpenLayers.Layer.ComplexVector"});OpenLayers.Theme={};OpenLayers.Theme.StandardTheme=OpenLayers.Class({initialize:function(a){},updateFeature:function(b,a){},attributes:function(){return[]},CLASS_NAME:"OpenLayers.Theme.StandardTheme"});OpenLayers.Theme.ChoroplethTheme=OpenLayers.Class(OpenLayers.Theme.StandardTheme,{initialize:function(a){if(a==undefined||a.attribute==undefined){return null}this.attribute=a.attribute;if(a.other_attributes!=undefined){this.other_attributes=a.other_attributes}else{this.other_attributes=[]}if(a.name!=undefined){this.name=a.name}else{this.name=this.attribute}if(a.colors!=undefined){this.colors=a.colors}else{this.colors=["#aaa"]}if(a.limits!=undefined){this.limits=a.limits}else{this.limits=[]}},updateFeature:function(c,b){if(this.attribute==null||this.colors==null||this.limits==null||c==undefined||b==undefined){return false}var a=b[this.attribute];if(a==undefined){return false}var d=this.fillColor(a);c.attributes.fillColor=d;return true},fillColor:function(b){if(this.colors==null||this.limits==null){return"#aaa"}this.limits.sort(function(e,d){return e-d});var c=0;for(var a=0;a<this.limits.length;a++){if(parseFloat(this.limits[a])>=parseFloat(b)){return this.colors[c]}c+=1}return this.colors[c]},attributes:function(){return this.other_attributes.concat([this.attribute])},CLASS_NAME:"OpenLayers.Theme.ChoroplethTheme"});if(typeof TAFFY=="undefined"||!TAFFY){var TAFFY=function(g){var k={template:null},e=TAFFY,n=(e.isString(g))?e.JSON.parse(g):g,i=n,a=[],o=true,j=false;var m=function(q,p){var p=(TAFFY.isUndefined(p))?k.template:p;if(!TAFFY.isNull(p)){for(var f=0;f<q.length;f++){i[q[f]]=TAFFY.mergeObj(i[q[f]],p)}}};var h=function(){a=[];for(var f=0;f<i.length;f++){a[a.length]=f}};h();var l={pickTest:function(p){var f=(p.indexOf("!")===0)?j:o;if(!f){p=p.substring(1,p.length)}return{test:(p=="equal")?"is":(p=="notequal")?"not":(p=="startswith")?"starts":(p=="endswith")?"ends":(p=="greaterthan")?"gt":(p=="lessthan")?"lt":(p=="regexppass")?"regex":p,mode:(f)?{s:o,f:j}:{s:j,f:o}}},run:function(q,r,p,f){return((q=="regex")?(p.test(r)):(q=="lt")?(r<p):(q=="gt")?(r>p):(q=="starts")?(r.indexOf(p)===0):(q=="ends")?(r.substring((r.length-p.length))==p):(q=="like")?(r.indexOf(p)>=0):(q=="is")?(r==p):(q=="has")?(e.has(r,p)):(q=="hasAll")?(e.hasAll(r,p)):(q=="length")?(l.length(r,p,f)):l[q](r,p))?f.s:f.f},length:function(u,p,f){var s=(!e.isUndefined(u.length))?u.length:(!e.isUndefined(u.getLength))?u.getLength():0;if(e.isObject(p)){for(var r in p){if(p.hasOwnProperty(r)){var q=l.pickTest(r);return l.run(q.test,s,p[r],q.mode)?o:j}}}return s==p?f.s:f.f}};(function(){for(var f in TAFFY){if(TAFFY.hasOwnProperty(f)&&f.indexOf("is")===0){(function(p){l["is"+p]=function(s,r,q){return(TAFFY["is"+p](s)==r)?o:j}}(f.substring(2,f.length)))}}}());var d=function(p,q){var r=[];if(!e.isArray(p)&&TAFFY.isNumber(p)){r[r.length]=p}else{if(e.isArray(p)){r=p}else{if(e.isObject(p)){r=q(p)}else{if(!e.isArray(p)&&!e.isNumber(p)){r=a}}}}return r};var b=function(q){var f=[0],p="none";if(!e.isNull(q)&&!e.isUndefined(q)){for(var s=0;s<q.length;s++){var r=q.slice(s,(s+1));if(e.isNumeric(r)){if(p!="number"){f[f.length]=r;p="number"}else{f[(f.length-1)]=f[(f.length-1)]+""+r}}else{if(p!="string"){f[f.length]=r;p="string"}else{f[(f.length-1)]=f[(f.length-1)]+r}}}for(var s=0;s<f.length;s++){if(e.isNumeric(f[s])){f[s]=parseFloat(f[s])}}}else{f[f.length]=null}return f};var c=function(q){var r=[],p=[];if(e.isString(q)){p[0]=q}else{if(e.isObject(q)){p=[q]}else{p=q}}if(e.isArray(p)){for(var f=0;f<p.length;f++){if(e.isString(p[f])){if(e.isString(i[0][p[f]])){r[r.length]={sortCol:p[f],sortDir:"asc",type:"string"}}else{r[r.length]={sortCol:p[f],sortDir:"asc",type:"number"}}}else{if(e.isObject(p[f])){for(var s in p[f]){if(p[f].hasOwnProperty(s)){if(e.isString(i[0][p[f].sortCol])){r[r.length]={sortCol:s,sortDir:p[f][s],type:"string"}}else{r[r.length]={sortCol:s,sortDir:p[f][s],type:"number"}}}}}}}}return function(D,C){var w=0,v=D,u=C,E,B;for(var F=0;F<r.length;F++){if(w===0){E=v[r[F]["sortCol"]];B=u[r[F]["sortCol"]];if(r[F].type=="string"){E=(e.isString(E))?E.toLowerCase():E;B=(e.isString(B))?B.toLowerCase():B}if(r[F].sortDir=="desc"){if(e.isNull(B)||e.isUndefined(B)||B<E){w=-1}else{if(e.isNull(E)||e.isUndefined(E)||E<B){w=1}}}else{if(r[F].sortDir=="logical"){E=b(E);B=b(B);for(var A=0;A<B.length;A++){if(E[A]<B[A]&&A<E.length){w=-1;break}else{if(E[A]>B[A]){w=1;break}}}if(E.length<B.length&&w==0){w=-1}else{if(E.length>B.length&&w==0){w=1}}}else{if(r[F].sortDir=="logicaldesc"){E=b(E);B=b(B);for(var A=0;A<B.length;A++){if(E[A]>B[A]&&A<E.length){w=-1;break}else{if(E[A]<B[A]){w=1;break}}}if(E.length<B.length&&w==0){w=1}else{if(E.length>B.length&&w==0){w=-1}}}else{if(e.isNull(E)||e.isUndefined(E)||E<B){w=-1}else{if(e.isNull(B)||e.isUndefined(B)||E>B){w=1}}}}}}}return w}};return{TAFFY:true,getLength:function(){return i.length},lastModifyDate:new Date(),find:function(u,C){var p=0;if(e.isArray(C)){var r=C}else{var r=a}if(e.isFunction(u)){var s=[];for(var w=0;w<r.length;w++){if(u(i[w],w)){s[s.length]=r[w]}}r=s}else{for(var v in u){var q="is",f="",B=v,y={s:o,f:j},A={};if(e.isObject(u[v])){for(var z in u[v]){A=l.pickTest(z);q=A.test;y=A.mode;f=u[v][z]}}else{f=u[v]}var s=[];for(var w=0;w<r.length;w++){if(e.isArray(f)&&q!="isSameArray"&&q!="hasAll"){for(var x=0;x<f.length;x++){if(l.run(q,i[r[w]][B],f[x],y)){s[s.length]=r[w]}}}else{if(e.isFunction(f)&&f(i[r[w]][B],w)){s[s.length]=r[w]}else{if(l.run(q,i[r[w]][B],f,y)){s[s.length]=r[w]}}}}r=s}}r=e.gatherUniques(r);return r},remove:function(f){var r=d(f,this.find);for(var s=0;s<r.length;s++){if(this.onRemove!=null){this.onRemove(i[r[s]])}i[r[s]]="remove"}var p=function(){for(var u=0;u<i.length;u++){if(i[u]==="remove"){return o}}return j};while(p()){for(var q=0;q<i.length;q++){if(i[q]==="remove"){i.splice(q,1);this.lastModifyDate=new Date()}}}h();return r},insert:function(f){if(this.onInsert!=null){this.onInsert(f)}i[i.length]=(TAFFY.isNull(k.template))?f:TAFFY.mergeObj(k.template,f);this.lastModifyDate=new Date();a[a.length]=i.length-1;return[i.length-1]},update:function(q,p){var s=d(p,this.find),f=0;for(var u=0;u<s.length;u++){var r=s[u];if(this.onUpdate!=null){this.onUpdate(q,i[r])}i[r]=e.mergeObj(i[r],q);f++}return s},get:function(f){var p=[];var r=d(f,this.find);for(var q=0;q<r.length;q++){p[p.length]=i[r[q]]}return p},first:function(f){var p=d(f,this.find);return(p.length>0)?i[p[0]]:false},last:function(f){var p=d(f,this.find);return(p.length>0)?i[p[(p.length-1)]]:false},stringify:function(f){return e.JSON.stringify(this.get(f))},orderBy:function(f){if(i.length>0){var p=c(f);i.sort(p);this.lastModifyDate=new Date()}},forEach:function(s,f){var r=d(f,this.find);var u;for(var p=0;p<r.length;p++){u=i[r[p]];var q=s(u,r[p]);if(e.isObject(q)){if(TAFFY.isSameObject(q,TAFFY.EXIT)){break}else{this.update(q,r[p])}}}},config:{set:function(p,f){k[p]=f;if(p=="template"&&!TAFFY.isNull(f)){m(a,f)}},get:function(f){return k[f]}},applyTemplate:function(p,f){var q=d(f,this.find);m(q,p)},onUpdate:null,onRemove:null,onInsert:null}};TAFFY.typeOf=function(a){var b=typeof a;if(b==="object"){if(a){if(typeof a.length==="number"&&!(a.propertyIsEnumerable("length"))&&typeof a.splice==="function"){b="array"}}else{b="null"}}return b};TAFFY.JSON=function(){function f(n){return n<10?"0"+n:n}Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z"};var m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function stringify(value,whitelist){var a,i,k,l,r=/["\\\x00-\x1f\x7f-\x9f]/g,v;switch(typeof value){case"string":return r.test(value)?'"'+value.replace(r,function(a){var c=m[a];if(c){return c}c=a.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"':'"'+value+'"';case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}if(typeof value.toJSON==="function"){return stringify(value.toJSON())}a=[];if(typeof value.length==="number"&&!(value.propertyIsEnumerable("length"))){l=value.length;for(i=0;i<l;i+=1){a.push(stringify(value[i],whitelist)||"null")}return"["+a.join(",")+"]"}if(whitelist){l=whitelist.length;for(i=0;i<l;i+=1){k=whitelist[i];if(typeof k==="string"){v=stringify(value[k],whitelist);if(v){a.push(stringify(k)+":"+v)}}}}else{for(k in value){if(typeof k==="string"){v=stringify(value[k],whitelist);if(v){a.push(stringify(k)+":"+v)}}}}return"{"+a.join(",")+"}"}return""}return{stringify:stringify,parse:function(text,filter){var j;function walk(k,v){var i,n;if(v&&typeof v==="object"){for(i in v){if(Object.prototype.hasOwnProperty.apply(v,[i])){n=walk(i,v[i]);if(n!==undefined){v[i]=n}else{delete v[i]}}}}return filter(k,v)}if(/^[\],:{}\s]*$/.test(text.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof filter==="function"?walk("",j):j}throw new SyntaxError("parseJSON")}}}();TAFFY.mergeObj=function(e,a){var d={};for(var b in e){if(e.hasOwnProperty(b)){d[b]=e[b]}}for(var b in a){if(a.hasOwnProperty(b)){d[b]=a[b]}}return d};TAFFY.getObjectKeys=function(a){var b=[];for(var c in a){if(a.hasOwnProperty(c)){b[b.length]=c}}b.sort();return b};TAFFY.isSameArray=function(b,a){return(TAFFY.isArray(b)&&TAFFY.isArray(a)&&b.join(",")==a.join(","))?true:false};TAFFY.isSameObject=function(d,b){var a=TAFFY;if(a.isObject(d)&&a.isObject(b)){if(a.isSameArray(a.getObjectKeys(d),a.getObjectKeys(b))){for(var c in d){if(d.hasOwnProperty(c)){if((a.isObject(d[c])&&a.isObject(b[c])&&a.isSameObject(d[c],b[c]))||(a.isArray(d[c])&&a.isArray(b[c])&&a.isSameArray(d[c],b[c]))||(d[c]==b[c])){}else{return false}}}}else{return false}}else{return false}return true};TAFFY.has=function(e,d){var b=TAFFY;var c=true;if(b.isTAFFY(e)){c=e.find(d);if(c.length>0){return true}else{return false}}else{switch(b.typeOf(e)){case"object":if(b.isObject(d)){for(var a in d){if(c==true&&d.hasOwnProperty(a)&&!b.isUndefined(e[a])&&e.hasOwnProperty(a)){c=b.has(e[a],d[a])}else{return false}}return c}else{if(b.isArray(d)){for(var a=0;a<d.length;a++){c=b.has(e,d[a]);if(c==true){return true}}}else{if(b.isString(d)&&e[d]!=undefined){return true}}}break;case"array":if(b.isObject(d)){for(var f=0;f<e.length;f++){c=b.has(e[f],d);if(c==true){return true}}}else{if(b.isArray(d)){for(var a=0;a<d.length;a++){for(var f=0;f<e.length;f++){c=b.has(e[f],d[a]);if(c==true){return true}}}}else{if(b.isString(d)){for(var f=0;f<e.length;f++){c=b.has(e[f],d);if(c==true){return true}}}}}break;case"string":if(b.isString(d)&&d==e){return true}break;default:if(b.typeOf(e)==b.typeOf(d)&&e==d){return true}break}}return false};TAFFY.hasAll=function(e,d){var b=TAFFY;if(b.isArray(d)){var a=true;for(var c=0;c<d.length;c++){a=b.has(e,d[c]);if(a==false){return a}}return true}else{return b.has(e,d)}};TAFFY.gatherUniques=function(b){var h=[];for(var f=0;f<b.length;f++){var e=true;for(var g=0;g<h.length;g++){if(h[g]==b[f]){e=false}}if(e==true){h[h.length]=b[f]}}return h};(function(a){for(var b=0;b<a.length;b++){(function(c){TAFFY["is"+c]=function(d){return(TAFFY.typeOf(d)==c.toLowerCase())?true:false}}(a[b]))}}(["String","Number","Object","Array","Boolean","Null","Function","Undefined"]));TAFFY.isNumeric=function(b){var c="0123456789";var a=true;for(var d=0;d<b.length&&a==true;d++){if(c.indexOf(b.charAt(d))==-1){return false}}return a};TAFFY.isTAFFY=function(a){return(TAFFY.isObject(a)&&a.TAFFY)?true:false};TAFFY.EXIT={EXIT:true}}var dateFormat=function(){var a=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,b=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,d=/[^-+\dA-Z]/g,c=function(f,e){f=String(f);e=e||2;while(f.length<e){f="0"+f}return f};return function(i,w,q){var g=dateFormat;if(arguments.length==1&&Object.prototype.toString.call(i)=="[object String]"&&!/\d/.test(i)){w=i;i=undefined}i=i?new Date(i):new Date;if(isNaN(i)){throw SyntaxError("invalid date")}w=String(g.masks[w]||w||g.masks["default"]);if(w.slice(0,4)=="UTC:"){w=w.slice(4);q=true}var u=q?"getUTC":"get",l=i[u+"Date"](),e=i[u+"Day"](),j=i[u+"Month"](),p=i[u+"FullYear"](),r=i[u+"Hours"](),k=i[u+"Minutes"](),v=i[u+"Seconds"](),n=i[u+"Milliseconds"](),f=q?0:i.getTimezoneOffset(),h={d:l,dd:c(l),ddd:g.i18n.dayNames[e],dddd:g.i18n.dayNames[e+7],m:j+1,mm:c(j+1),mmm:g.i18n.monthNames[j],mmmm:g.i18n.monthNames[j+12],yy:String(p).slice(2),yyyy:p,h:r%12||12,hh:c(r%12||12),H:r,HH:c(r),M:k,MM:c(k),s:v,ss:c(v),l:c(n,3),L:c(n>99?Math.round(n/10):n),t:r<12?"a":"p",tt:r<12?"am":"pm",T:r<12?"A":"P",TT:r<12?"AM":"PM",Z:q?"UTC":(String(i).match(b)||[""]).pop().replace(d,""),o:(f>0?"-":"+")+c(Math.floor(Math.abs(f)/60)*100+Math.abs(f)%60,4),S:["th","st","nd","rd"][l%10>3?0:(l%100-l%10!=10)*l%10]};return w.replace(a,function(m){return m in h?h[m]:m.slice(1,m.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};Date.prototype.format=function(a,b){return dateFormat(this,a,b)};