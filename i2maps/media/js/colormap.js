if(i2maps == undefined) i2maps = {};
i2maps.colormap = (function (){
    var o = {};
    o.colormaps = {};
    o.colormaps['jet'] = {
        "blue": [[0.0, 0.5, 0.5], [0.11, 1, 1], [0.34, 1, 1], [0.65, 0, 0], [1, 0, 0]], 
        "green": [[0.0, 0, 0], [0.125, 0, 0], [0.375, 1, 1], [0.64, 1, 1], [0.91, 0, 0], [1, 0, 0]], 
        "red": [[0.0, 0, 0], [0.35, 0, 0], [0.66, 1, 1], [0.89, 1, 1], [1, 0.5, 0.5]]};
    o.colormaps['hot'] = {
        "blue": [[0.0, 0.0, 0.0], [0.746032, 0.0, 0.0], [1.0, 1.0, 1.0]], 
        "green": [[0.0, 0.0, 0.0], [0.365079, 0.0, 0.0], [0.746032, 1.0, 1.0], [1.0, 1.0, 1.0]], 
        "red": [[0.0, 0.0416, 0.0416], [0.365079, 1.0, 1.0], [1.0, 1.0, 1.0]]};
    o.colormaps['grays'] = {
        "blue": [[0.0, 0, 0], [1.0, 1, 1]], 
        "green": [[0.0, 0, 0], [1.0, 1, 1]], 
        "red": [[0.0, 0, 0], [1.0, 1, 1]]};
    o.colormaps['Paired'] = {
        "blue": [[0.0, 0.8901960849761963, 0.8901960849761963], [0.09090909090909091, 0.7058823704719543, 0.7058823704719543], [0.18181818181818182, 0.5411764979362488, 0.5411764979362488], [0.2727272727272727, 0.1725490242242813, 0.1725490242242813], [0.36363636363636365, 0.6000000238418579, 0.6000000238418579], [0.45454545454545453, 0.10980392247438431, 0.10980392247438431], [0.5454545454545454, 0.43529412150382996, 0.43529412150382996], [0.6363636363636364, 0.0, 0.0], [0.7272727272727273, 0.8392156958580017, 0.8392156958580017], [0.8181818181818182, 0.6039215922355652, 0.6039215922355652], [0.9090909090909091, 0.6000000238418579, 0.6000000238418579], [1.0, 0.1568627506494522, 0.1568627506494522]], 
        "green": [[0.0, 0.8078431487083435, 0.8078431487083435], [0.09090909090909091, 0.47058823704719543, 0.47058823704719543], [0.18181818181818182, 0.8745098114013672, 0.8745098114013672], [0.2727272727272727, 0.6274510025978088, 0.6274510025978088], [0.36363636363636365, 0.6039215922355652, 0.6039215922355652], [0.45454545454545453, 0.10196078568696976, 0.10196078568696976], [0.5454545454545454, 0.7490196228027344, 0.7490196228027344], [0.6363636363636364, 0.49803921580314636, 0.49803921580314636], [0.7272727272727273, 0.6980392336845398, 0.6980392336845398], [0.8181818181818182, 0.239215686917305, 0.239215686917305], [0.9090909090909091, 1.0, 1.0], [1.0, 0.3490196168422699, 0.3490196168422699]], 
        "red": [[0.0, 0.6509804129600525, 0.6509804129600525], [0.09090909090909091, 0.12156862765550613, 0.12156862765550613], [0.18181818181818182, 0.6980392336845398, 0.6980392336845398], [0.2727272727272727, 0.20000000298023224, 0.20000000298023224], [0.36363636363636365, 0.9843137264251709, 0.9843137264251709], [0.45454545454545453, 0.8901960849761963, 0.8901960849761963], [0.5454545454545454, 0.9921568632125854, 0.9921568632125854], [0.6363636363636364, 1.0, 1.0], [0.7272727272727273, 0.7921568751335144, 0.7921568751335144], [0.8181818181818182, 0.4156862795352936, 0.4156862795352936], [0.9090909090909091, 1.0, 1.0], [1.0, 0.6941176652908325, 0.6941176652908325]]};
    var interpolate = function(f, a, b){
        return a + (f * (b-a));
    }
    var find_index = function(a, v){for(var i=0; i < a.length; i++){if(v < a[i]) return i}};
    
    var lpad = function(s, len){while(s.length < len){s = '0' + s} return s};
    
    var make_colormap = function(name){
        var cdict = o.colormaps[name];
        var stops = {};
        for(c in cdict)
        {
            stops[c] = [];
            cdict[c].forEach(function(x){stops[c].push(x[0])})
        }
        var f = function(min, max){
            var cm = function(value, default_color)
            {
                if(value == undefined || value < min || value > max){
                  if(typeof("default_color") == "string") return default_color;
                  var c = default_color || [0,0,0];
                  color = {'red': c[0], 'green': c[1], 'blue': c[0]};
                }
                else{
                  var v = (value-min) * (1/(max-min));
                  // console.log('v:' + v);
                  var color = {};
                  for(c in cdict)
                  {
                      if(v < 0) v = 0;
                      if(v < 1)
                      {
                          var key = find_index(stops[c], v) - 1;
                          var x0 = cdict[c][key][0];
                          var x1 = cdict[c][key+1][0];
                          var x = (v - x0)/ (x1 - x0);
                          var a = cdict[c][key][2];
                          var b = cdict[c][key+1][1];
                          color[c] = interpolate(x, a, b);
                      }
                      else
                      {
                          color[c] = cdict[c][stops[c].length-1][2];
                      }
                      color[c] = Math.floor(color[c] * 255);
                  }
                }
                if(arguments[arguments.length-1] === true)
                {
                      return "#" + lpad(color['red'].toString(16), 2) + lpad(color['green'].toString(16), 2) + lpad(color['blue'].toString(16), 2);
                }
                var c = [color['red'], color['green'], color['blue'], 255];
                c.html = function(){
                    return "#" + lpad(this[0].toString(16), 2) + lpad(this[1].toString(16), 2) + lpad(this[2].toString(16), 2);
                };
                
                return c;
            }
            cm.min = min;
            cm.max = max;
            return cm;
        }
        return f
    }
    
    for(var c in o.colormaps)
    {
        o.__defineGetter__(c, (function(c){return function(){return make_colormap(c)}})(c));
    }
    
    
    o.jet2 = function(value, min, max, hex)
    {
          var r = 0;
          var g = 0;
          var b = 0;
          var v = 1 - (value - min) * (1 / (max - min));
          if(v < 0.33)
          {
              r = 208;
              g = 131 + ((208-131) * v/0.33);
              b = 131;
          }
          else if(v >= 0.33 && v < 0.66)
          {
              r = 208 - ((208-131) * (v-0.33)/0.33);
              g = 208
              b = 131 + ((208-131) * (v-0.33)/0.33);
          }
          else //if(v >= 0.66)
          {
              r = 131;
              g = 208 - ((208-131) * (v-0.66)/0.33);
              b = 208;
          }
          r = Math.floor(r);
          g = Math.floor(g);
          b = Math.floor(b);
          if(hex)
          {
              return "#" + r.toString(16) + g.toString(16) + b.toString(16);
          }
          return [r,g,b];
    }
    
    o.categories = function (i, n)
    {
        var colors = [];
        if(n <= 10)
        {
            colors = ["#1f77b4", "#ff7f0e", "#2ca02c", "#d62728", "#9467bd", "#8c564b", "#e377c2", "#7f7f7f", "#bcbd22", "#17becf"];
        }
        else
        {
            colors = ["#9c9ede", "#7375b5", "#4a5584", "#cedb9c", "#b5cf6b", "#8ca252", "#637939", "#e7cb94", "#e7ba52", "#bd9e39", "#8c6d31", "#e7969c", "#d6616b", "#ad494a", "#843c39", "#de9ed6", "#ce6dbd", "#a55194", "#7b4173"];
        }
        if(i >= colors.length) i = colors.length - 1;
        return colors[i];
    }
    return o;
})();




